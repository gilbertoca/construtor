<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="http://java.sun.com/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm
                 http://java.sun.com/xml/ns/persistence/orm/orm_2_0.xsd"
                 version="2.0">
    <persistence-unit-metadata>
        <persistence-unit-defaults>
            <schema>park</schema>
        </persistence-unit-defaults>
    </persistence-unit-metadata>
    <package>park.model</package>
    <entity class="Person">
       <!-- CREATE TABLE PERSON (
            ID_PERSON INTEGER NOT NULL,
            ADDRESS VARCHAR(100),
            NAME VARCHAR(100) NOT NULL,
            P_TYPE CHAR(2) NOT NULL, //NATURALPERSON(NP) OR LEGALENTITY(LE)
            VERSION SMALLINT NOT NULL
            CONSTRAINT PERSON_PKEY PRIMARY KEY (ID_PERSON)
        );
        -->
        <table name="person"/>
        <inheritance strategy="JOINED"/>
        <discriminator-column name="p_type" column-definition="CHAR(2)" length="2" discriminator-type="STRING"/>
        <attributes>
            <id name="idPerson">
                <column name="id_person"/>
                <generated-value strategy="AUTO"/>
            </id>
            <basic name="name">
                    <column length="100"/>
            </basic>
            <basic name="address">
                    <column length="100"/>
            </basic>
            <version name="version"/>
        </attributes>
    </entity>
    <entity class="NaturalPerson">
        <!--CREATE TABLE NATURAL_PERSON (
            ID_PERSON INTEGER NOT NULL,
            DT_BIRTH DATE,
            LEGAL_DOCUMENT VARCHAR(20),
            CONSTRAINT NATURAL_PERSON_PKEY PRIMARY KEY (ID_PERSON)
        );
        -->
        <table name="natural_person"/>
        <primary-key-join-column name="id_person" referenced-column-name="id_person"/>
        <discriminator-value>NP</discriminator-value>
        <named-query name="NaturalPerson.findAll">
            <query>SELECT n FROM NaturalPerson n</query>
            <!--hint name="javax.persistence.cacheRetrieveMode"  value="CacheRetrieveMode.BYPASS"/-->
        </named-query>
        <named-query name="NaturalPerson.deleteById">
            <query>DELETE FROM NaturalPerson n WHERE n.idPerson = :idPerson</query>
        </named-query>
        <attributes>
            <basic name="dtBirth">
                <column name="dt_birth"/>
                <temporal>DATE</temporal>
            </basic>
            <basic name="legalDocument">
                <column name="legal_document" length="20"/>
            </basic>
        </attributes>
    </entity>
    <entity class="LegalEntity">
        <!--
            CREATE TABLE LEGAL_ENTITY (
                ID_PERSON INTEGER NOT NULL,
                TAXPAYERS_ID VARCHAR(20) NOT NULL,
                DT_FOUNDATION DATE NOT NULL,
                CONSTRAINT LEGAL_ENTITY_PK PRIMARY KEY (ID_PERSON)
            );
        -->
        <table name="legal_entity"/>
        <primary-key-join-column name="id_person" referenced-column-name="id_person"/>
        <discriminator-value>LE</discriminator-value>
        <named-query name="LegalEntity.findAll">
            <query>SELECT l FROM LegalEntity l</query>
            <!--hint name="javax.persistence.cacheRetrieveMode"  value="CacheRetrieveMode.BYPASS"/-->
        </named-query>
        <named-query name="LegalEntity.deleteById">
            <query>DELETE FROM LegalEntity l WHERE l.idPerson = :idPerson</query>
        </named-query>
        <attributes>
            <basic name="dtFoundation">
                <column name="dt_foundation"/>
                <temporal>DATE</temporal>
            </basic>
            <basic name="taxpayersId">
                <column name="taxpayers_id" length="20"/>
            </basic>
        </attributes>
    </entity>

</entity-mappings>
