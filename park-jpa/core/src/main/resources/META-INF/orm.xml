<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="http://java.sun.com/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm
                 http://java.sun.com/xml/ns/persistence/orm/orm_2_0.xsd"
                 version="2.0">
    <persistence-unit-metadata>
        <persistence-unit-defaults>
            <schema>park</schema>
        </persistence-unit-defaults>
    </persistence-unit-metadata>
    <package>park.model</package>
    <entity class="Person">
        <!-- CREATE TABLE PERSON (
            ID INTEGER NOT NULL,
            ADDRESS VARCHAR(100),
            NAME VARCHAR(100) NOT NULL,
            P_TYPE CHAR(2) NOT NULL, //NATURALPERSON(NP) OR LEGALENTITY(LE)
            VERSION SMALLINT NOT NULL
            CONSTRAINT PERSON_PKEY PRIMARY KEY (ID)
        );
        -->
        <table name="person"/>
        <inheritance strategy="JOINED"/>
        <discriminator-column name="p_type" column-definition="CHAR(2)" length="2" discriminator-type="STRING"/>
        <attributes>
            <id name="id">
                <column name="id"/>
                <generated-value strategy="AUTO"/>
            </id>
            <basic name="name">
                <column length="100"/>
            </basic>
            <basic name="address">
                <column length="100"/>
            </basic>
            <version name="version"/>
        </attributes>
    </entity>
    <entity class="NaturalPerson">
        <!--CREATE TABLE NATURAL_PERSON (
            PERSON_ID INTEGER NOT NULL,
            DT_BIRTH DATE,
            LEGAL_DOCUMENT VARCHAR(20),
            CONSTRAINT NATURAL_PERSON_PKEY PRIMARY KEY (PERSON_ID)
        );
        -->
        <table name="natural_person"/>
        <primary-key-join-column name="person_id" referenced-column-name="id"/>
        <discriminator-value>NP</discriminator-value>
        <named-query name="NaturalPerson.findAll">
            <query>SELECT n FROM NaturalPerson n</query>
            <!--hint name="javax.persistence.cacheRetrieveMode"  value="CacheRetrieveMode.BYPASS"/-->
        </named-query>
        <named-query name="NaturalPerson.deleteById">
            <query>DELETE FROM NaturalPerson n WHERE n.id = :personID</query>
        </named-query>
        <attributes>
            <basic name="dtBirth">
                <column name="dt_birth"/>
                <temporal>DATE</temporal>
            </basic>
            <basic name="legalDocument">
                <column name="legal_document" length="20"/>
            </basic>
        </attributes>
    </entity>
    <entity class="LegalEntity">
        <!--
            CREATE TABLE LEGAL_ENTITY (
                PERSON_ID INTEGER NOT NULL,
                TAXPAYERS_ID VARCHAR(20) NOT NULL,
                DT_FOUNDATION DATE NOT NULL,
                CONSTRAINT LEGAL_ENTITY_PK PRIMARY KEY (PERSON_ID)
            );
        -->
        <table name="legal_entity"/>
        <primary-key-join-column name="person_id" referenced-column-name="id"/>
        <discriminator-value>LE</discriminator-value>
        <named-query name="LegalEntity.findAll">
            <query>SELECT l FROM LegalEntity l</query>
            <!--hint name="javax.persistence.cacheRetrieveMode"  value="CacheRetrieveMode.BYPASS"/-->
        </named-query>
        <named-query name="LegalEntity.deleteById">
            <query>DELETE FROM LegalEntity l WHERE l.id = :personID</query>
        </named-query>
        <attributes>
            <basic name="dtFoundation">
                <column name="dt_foundation"/>
                <temporal>DATE</temporal>
            </basic>
            <basic name="taxpayersId">
                <column name="taxpayers_id" length="20"/>
            </basic>
        </attributes>
    </entity>
    <entity class="Customer">
        <!--
            CREATE TABLE CUSTOMER (
                            PERSON_ID INTEGER NOT NULL,
                            PAYMENT_DAY INTEGER,
                            CONSTRAINT CUSTOMER_PK PRIMARY KEY (PERSON_ID)
            );
        -->
        <table name="customer"/>
        <named-query name="Customer.findAll">
            <query>SELECT l FROM Customer l</query>
            <!--hint name="javax.persistence.cacheRetrieveMode"  value="CacheRetrieveMode.BYPASS"/-->
        </named-query>
        <named-query name="Customer.deleteById">
            <query>DELETE FROM Customer l WHERE l.id = :id</query>
        </named-query>
        <attributes>
            <id name="personId">
                <column name="person_id"/>
            </id>
            <basic name="paymentDay">
                <column name="payment_day"/>
            </basic>
            <one-to-many name="vehicles" target-entity="park.model.Vehicle" mapped-by="customer">
            </one-to-many>
            <one-to-one name="person" maps-id="true"/>

        </attributes>
    </entity>

    <entity class="PriceTable">
        <!--
            CREATE TABLE PRICE_TABLE (
                ID INTEGER NOT NULL,
                ITEM VARCHAR(50) NOT NULL,
                PRICE NUMERIC(12,2) NOT NULL,
                CONSTRAINT PRICE_TABLE_PK PRIMARY KEY (ID)
            );
        -->
        <table name="price_table"/>
        <named-query name="PriceTable.findAll">
            <query>SELECT l FROM PriceTable l</query>
            <!--hint name="javax.persistence.cacheRetrieveMode"  value="CacheRetrieveMode.BYPASS"/-->
        </named-query>
        <named-query name="PriceTable.deleteById">
            <query>DELETE FROM PriceTable l WHERE l.id = :id</query>
        </named-query>

        <attributes>
            <id name="id">
                <column name="id"/>
                <generated-value strategy="AUTO"/>
            </id>
            <basic name="item">
                <column name="item" nullable="false" length="50"/>
            </basic>
            <basic name="price">
                <column name="price" column-definition="NUMERIC(12,2)"/>
            </basic>
        </attributes>
    </entity>
    <entity class="VehicleType">
        <!--
            CREATE TABLE VEHICLE_TYPE (
                            V_TYPE VARCHAR(20) NOT NULL,
                            MANUFACTURER VARCHAR(50),
                            MODEL VARCHAR(20),
                            CONSTRAINT VEHICLE_TYPE_PK PRIMARY KEY (V_TYPE)
            );
        -->
        <table name="vehicle_type"/>
        <named-query name="VehicleType.findAll">
            <query>SELECT l FROM VehicleType l</query>
            <!--hint name="javax.persistence.cacheRetrieveMode"  value="CacheRetrieveMode.BYPASS"/-->
        </named-query>
        <named-query name="VehicleType.deleteById">
            <query>DELETE FROM VehicleType l WHERE l.vType = :vType</query>
        </named-query>

        <attributes>
            <id name="vType">
                <column name="v_type" nullable="false" length="20"/>
            </id>
            <basic name="manufacturer">
                <column name="manufacturer" length="50"/>
            </basic>
            <basic name="model">
                <column name="model" length="20"/>
            </basic>
        </attributes>
    </entity>
    <entity class="Vehicle">
        <!--
        CREATE TABLE VEHICLE (
                        LICENSE_PLATE VARCHAR(20) NOT NULL,
                        V_TYPE VARCHAR(20) NOT NULL,
                        CUSTOMER_ID INTEGER NOT NULL,
                        PRICE_TABLE_ID INTEGER NOT NULL,
                        COLOR VARCHAR(20),
                        CONSTRAINT VEHICLE_PK PRIMARY KEY (LICENSE_PLATE)
        );
        -->
        <table name="vehicle"/>
        <named-query name="Vehicle.findAll">
            <query>SELECT l FROM Vehicle l</query>
            <!--hint name="javax.persistence.cacheRetrieveMode"  value="CacheRetrieveMode.BYPASS"/-->
        </named-query>
        <named-query name="Vehicle.deleteById">
            <query>DELETE FROM Vehicle l WHERE l.licensePlate = :licensePlate</query>
        </named-query>

        <attributes>
            <id name="licensePlate">
                <column name="license_plate" length="20"/>
            </id>
            <basic name="color">
                <column name="color" length="20"/>
            </basic>
            <many-to-one name="customer">
                <join-column name="customer_id" referenced-column-name="id"/>
            </many-to-one>
            <many-to-one name="priceTable">
                <join-column name="price_table_id" referenced-column-name="id"/>
            </many-to-one>
            <many-to-one name="vType">
                <join-column name="v_type" referenced-column-name="v_type"/>
            </many-to-one>
            <!-- one-to-many name="stays">
                <order-by/>
                <join-table name="stay">
                    <join-column name="stay_id" referenced-column-name="id"/>
                </join-table>
            </one-to-many-->

        </attributes>
    </entity>

</entity-mappings>
